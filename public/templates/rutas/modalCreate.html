<link rel="stylesheet" type="text/css" href="../../stylesheets/ruta-maps.css">

<div class="modal-header">
   <div class="pull-right">
     <button type="button" class="close pull-right" ng-click="$dismiss()">&times;</button>
   </div>
<div>
   <h3 class="modal-title" ng-if="!item._id">Create</h3>
   <h3 class="modal-title" ng-if="item._id">Edit</h3>
</div>
</div>
<div>
<form name="myForm" ng-submit="save()" method="POST">
   <div class="modal-body">
     <fieldset>
       <div class="row" ><div class="form-group col-md-12"><label for="nombre" class="bold">NOMBRE</label><input  autofocus required name="nombre" type="text" class="form-control"  ng-model="item.nombre" ></div></div>
       <div class="row" ><div class="form-group col-md-12"><label for="tipo" class="bold">TIPO</label><input  autofocus required name="tipo" type="text" class="form-control"  ng-model="item.tipo" ></div></div>
       <div id="ruta" class="row" ><div class="form-group col-md-12"><label for="ruta" class="bold">RUTA</label><input  autofocus required name="ruta" type="text" class="form-control"  ng-model="item.ruta" ></div></div>
       <h2>Elija la ruta en el mapa: </h2>
       <div id="map"></div>
       <div id="right-panel">
         <p>Total Distance: <span id="total"></span></p>
       </div>
     </fieldset>
</div>
<div class="modal-footer">
   <button ng-disabled="myForm.$invalid || myForm.$pristine" class="btn btn-primary pull-right" type="submit" title="Save"><span ng-if="saving"><i class="fa fa-spinner fa fa-spin"></i>&nbsp;</span><span>Save</span></button>
</div>
</form>
</div>
<style>
  #map {
    height: 100%;
    float: left;
    width: 63%;
    height: 100%;
  }
  #right-panel {
    float: right;
    width: 0%;
    height: 0%;
  }
#right-panel {
font-family: 'Roboto','sans-serif';
line-height: 30px;
padding-left: 10px;
}

#right-panel select, #right-panel input {
font-size: 15px;
}

#right-panel select {
width: 100%;
}

#right-panel i {
font-size: 12px;
}

  .panel {
    height: 100%;
    overflow: auto;
  }
</style>
<script>
function initMap() {
var map = new google.maps.Map(document.getElementById('map'), {
zoom: 4,
center: {lat: -2.163545, lng: -79.939192}  // Ceibos
});

var directionsService = new google.maps.DirectionsService;
var directionsDisplay = new google.maps.DirectionsRenderer({
draggable: true,
map: map,
panel: document.getElementById('right-panel')
});
directionsDisplay.addListener('directions_changed', function() {
computeTotalDistance(directionsDisplay.getDirections());
updateField(directionsDisplay);
});
var origin = new google.maps.LatLng(-2.148978, -79.964101);
var destiny = new google.maps.LatLng(-2.169924, -79.918545);
displayRoute(origin,destiny, directionsService,
    directionsDisplay);
}

function displayRoute(origin,destination, service, display){
service.route({
origin: origin,
destination: destination,
travelMode: google.maps.TravelMode.DRIVING,
avoidTolls: true
}, function(response, status) {
if (status === google.maps.DirectionsStatus.OK) {
  display.setDirections(response);
} else {
  alert('Could not display directions due to: ' + status);
}
});
}

function computeTotalDistance(result) {
var total = 0;
var myroute = result.routes[0];
for (var i = 0; i < myroute.legs.length; i++) {
total += myroute.legs[i].distance.value;
}
total = total / 1000;
document.getElementById('total').innerHTML = total + ' km';
}

function updateField(directionsDisplay){
  var start = JSON.stringify(directionsDisplay.getDirections().routes[0].legs[0].start_address);
  var end =  JSON.stringify(directionsDisplay.getDirections().routes[0].legs[0].end_address);
  var legs =  JSON.stringify(directionsDisplay.getDirections().routes[0].legs[0]);
  var legs_obj = JSON.parse(legs);
  console.log(start);
  console.log(end);
  console.log(legs);
  document.getElementById("ruta").value = legs;
  console.log(document.getElementById("ruta").value);
}

</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqAHlnALaVZ39B9c6XSE_wr0B1IBMf5LY&callback=initMap" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
